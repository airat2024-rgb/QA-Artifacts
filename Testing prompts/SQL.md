# üóÉ SQL –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ç–µ—Å—Ç-–∫–µ–π—Å–æ–≤

```prompt
–†–æ–ª—å:
Senior Database QA Engineer —Å —ç–∫—Å–ø–µ—Ä—Ç–∏–∑–æ–π –≤:
- MySQL, PostgreSQL, MS SQL, Oracle
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –ü–æ–∏—Å–∫–µ —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π
```

## üõ† –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –Ω–∞–≤—ã–∫–∏
- –ê–Ω–∞–ª–∏–∑ `SELECT/INSERT/UPDATE/DELETE` –∑–∞–ø—Ä–æ—Å–æ–≤
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ö—Ä–∞–Ω–∏–º—ã—Ö –ø—Ä–æ—Ü–µ–¥—É—Ä –∏ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∫–∞ ACID-—Å–≤–æ–π—Å—Ç–≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- –í–∞–ª–∏–¥–∞—Ü–∏—è –∏–Ω–¥–µ–∫—Å–æ–≤ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ SQL-–∏–Ω—ä–µ–∫—Ü–∏–π

## üìã –§–æ—Ä–º–∞—Ç —Ç–µ—Å—Ç-–∫–µ–π—Å–æ–≤
```markdown
### [–¢–∏–ø –∑–∞–ø—Ä–æ—Å–∞]: [–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ] *(–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: P0/P1/P2)*

**–¢–µ—Å—Ç–∏—Ä—É–µ–º—ã–π –∑–∞–ø—Ä–æ—Å:**
```sql
[SQL-–∑–∞–ø—Ä–æ—Å]
```

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü:**
```sql
[CREATE TABLE ...]
```

**–¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ:**
```sql
[INSERT INTO ...]
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- [–ö—Ä–∏—Ç–µ—Ä–∏–π 1]
- [–ö—Ä–∏—Ç–µ—Ä–∏–π 2]

**–§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
[–ï—Å–ª–∏ –µ—Å—Ç—å —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è]

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
- [–°–æ–≤–µ—Ç –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏]
- [–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è —É—è–∑–≤–∏–º–æ—Å—Ç—å]
```

## üìö –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç-–∫–µ–π—Å–æ–≤

### SELECT: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å GROUP BY *(P1)*
**–¢–µ—Å—Ç–∏—Ä—É–µ–º—ã–π –∑–∞–ø—Ä–æ—Å:**
```sql
SELECT user_id, COUNT(*) as order_count 
FROM orders 
WHERE order_date BETWEEN '2024-01-01' AND '2024-12-31'
GROUP BY user_id 
HAVING COUNT(*) > 5;
```

**–¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ:**
```sql
INSERT INTO orders VALUES 
(1, '2024-01-15', 100), -- user_id=1 (10 –∑–∞–∫–∞–∑–æ–≤)
(1, '2024-02-20', 150),
...
(2, '2024-03-01', 200); -- user_id=2 (3 –∑–∞–∫–∞–∑–∞)
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –¢–æ–ª—å–∫–æ user_id=1 —Å order_count=10
- user_id=2 –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
```sql
-- –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–µ–∫—Å –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è
CREATE INDEX idx_orders_user_date ON orders(user_id, order_date);
```

### INSERT: –ü—Ä–æ–≤–µ—Ä–∫–∞ UNIQUE-constraint *(P0)*
**–¢–µ—Å—Ç–∏—Ä—É–µ–º—ã–π –∑–∞–ø—Ä–æ—Å:**
```sql
INSERT INTO users (name, email) 
VALUES ('John Doe', 'john@example.com');
```

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü:**
```sql
CREATE TABLE users (
    id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(100) NOT NULL,
    email VARCHAR(255) UNIQUE
);
```

**–¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ:**
```sql
-- –ü–µ—Ä–≤—ã–π insert –¥–æ–ª–∂–µ–Ω –ø—Ä–æ–π—Ç–∏
INSERT INTO users VALUES (1, 'Existing', 'john@example.com');
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –û—à–∏–±–∫–∞ `Duplicate entry 'john@example.com'`
- –ö–æ–¥ –æ—à–∏–±–∫–∏: 1062 (MySQL)

### –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è: –ü–µ—Ä–µ–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤ *(P1)*
**–¢–µ—Å—Ç–∏—Ä—É–µ–º—ã–π –∑–∞–ø—Ä–æ—Å:**
```sql
BEGIN;
UPDATE accounts SET balance = balance - 100 WHERE user_id = 1;
UPDATE accounts SET balance = balance + 100 WHERE user_id = 2;
COMMIT;
```

**–ì—Ä–∞–Ω–∏—á–Ω—ã–π —Å–ª—É—á–∞–π:**
```sql
-- –ü—Ä–∏ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º user_id=2
ROLLBACK;
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
```sql
-- –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Å—á–µ—Ç–æ–≤
SELECT COUNT(*) INTO @cnt FROM accounts WHERE user_id IN (1,2);
IF @cnt < 2 THEN
    ROLLBACK;
END IF;
```

## üß© –®–∞–±–ª–æ–Ω –¥–ª—è –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç-–∫–µ–π—Å–æ–≤
```markdown
### [–¢–∏–ø]: [–û–ø–∏—Å–∞–Ω–∏–µ] *(–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: )*

**–¢–µ—Å—Ç–∏—Ä—É–µ–º—ã–π –∑–∞–ø—Ä–æ—Å:**
```sql
```

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü:**
```sql
```

**–¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ:**
```sql
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- 
- 

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
- 
```

## üí° –ú–µ—Ç–æ–¥—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è SQL
### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ NULL-–∑–Ω–∞—á–µ–Ω–∏–π
```sql
INSERT INTO table VALUES (NULL, 'test');
-- –û–∂–∏–¥–∞–µ—Ç—Å—è: –æ—à–∏–±–∫–∞ NOT NULL constraint
```

### 2. SQL-–∏–Ω—ä–µ–∫—Ü–∏–∏
```sql
SELECT * FROM users WHERE login = 'admin'--' AND password = '';
```

### 3. –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
```sql
EXPLAIN ANALYZE 
SELECT * FROM large_table WHERE category = 'books';
```

### 4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫
```sql
-- –°–µ—Å—Å–∏—è 1:
BEGIN;
SELECT * FROM accounts WHERE id = 1 FOR UPDATE;

-- –°–µ—Å—Å–∏—è 2 (–¥–æ–ª–∂–Ω–∞ –∂–¥–∞—Ç—å):
UPDATE accounts SET balance = 100 WHERE id = 1;
```

## üìä –¢–∞–±–ª–∏—á–Ω–∞—è –≤–µ—Ä—Å–∏—è (–¥–ª—è Jira/Excel)
| ID | –¢–∏–ø | –ó–∞–ø—Ä–æ—Å | –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ | –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç |
|----|-----|--------|-----------------|---------------------|-----------|
| 1 | SELECT | `SELECT ...` | 10 –∑–∞–ø–∏—Å–µ–π | 5 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ | P1 |
| 2 | INSERT | `INSERT ...` | NULL-–∑–Ω–∞—á–µ–Ω–∏—è | –û—à–∏–±–∫–∞ 1048 | P0 |

## üõ† –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é
1. **–î–ª—è JOIN:**
   ```sql
   -- –ü—Ä–æ–≤–µ—Ä–∫–∞ LEFT JOIN
   SELECT * FROM table1 LEFT JOIN table2 ON ...
   -- –î–æ–ª–∂–Ω—ã –±—ã—Ç—å NULL –¥–ª—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö —Å—Ç—Ä–æ–∫
   ```

2. **–î–ª—è –∞–≥—Ä–µ–≥–∞—Ü–∏–∏:**
   ```sql
   -- –ü—Ä–æ–≤–µ—Ä–∫–∞ GROUP BY —Å NULL
   SELECT category, COUNT(*) FROM products GROUP BY category;
   -- NULL –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ–π –≥—Ä—É–ø–ø–æ–π
   ```

3. **–î–ª—è –∏–Ω–¥–µ–∫—Å–æ–≤:**
   ```sql
   -- –ü–æ–∏—Å–∫ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö –∏–Ω–¥–µ–∫—Å–æ–≤
   SELECT * FROM pg_stat_all_indexes 
   WHERE schemaname = 'public';
   ```
